let e=document.getElementById("form-validar"),s=document.getElementById("login-section"),i=document.getElementById("cambiar-section"),t=document.getElementById("form-cambiar"),r=document.getElementById("cambiarBtn"),a=document.getElementById("form-reset"),o=document.getElementById("criterios"),n=document.getElementById("loader"),d=document.getElementById("toast"),c=document.getElementById("nuevaPassword"),l=document.getElementById("confirmPassword"),m=document.getElementById("sugerirBtn"),u=document.getElementById("sugerencia"),g=document.getElementById("sugeridaTexto"),y=document.getElementById("usarSugerida"),h=document.getElementById("copiarSugerida"),v=window.location.pathname.split("/"),p=v[v.length-1],E=(console.log("Hash:",p),"");function w(){n.classList.remove("hidden")}function x(){n.classList.add("hidden")}function B(e){d.textContent=e,d.classList.remove("hidden"),setTimeout(()=>{d.classList.add("hidden")},3e3)}function L(){var e=c.value,t=l.value,a=12<=e.length,n=/[A-Z]/.test(e),s=/[a-z]/.test(e),i=/\d/.test(e),d=/[^A-Za-z0-9]/.test(e),t=e===t&&0<e.length,e=a&&n&&s&&i&&d;o.innerHTML=`
    <ul class="space-y-1">
      <li class="${a?"text-green-500":"text-red-500"}">${a?"✅":"❌"} Mínimo 12 caracteres</li>
      <li class="${n?"text-green-500":"text-red-500"}">${n?"✅":"❌"} Contiene mayúsculas</li>
      <li class="${s?"text-green-500":"text-red-500"}">${s?"✅":"❌"} Contiene minúsculas</li>
      <li class="${i?"text-green-500":"text-red-500"}">${i?"✅":"❌"} Contiene números</li>
      <li class="${d?"text-green-500":"text-red-500"}">${d?"✅":"❌"} Contiene caracteres especiales</li>
      <li class="${t?"text-green-500":"text-red-500"}">${t?"✅":"❌"} Coinciden las contraseñas</li>
    </ul>
  `,r.disabled=!(e&&t)}e&&e.addEventListener("submit",async e=>{e.preventDefault();var e=document.getElementById("usuario").value,t=document.getElementById("password").value;w();try{var a=await fetch("/hash/validar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({usuario:e,password:t})}),n=await a.json();x(),B(n.message),a.ok&&(E=e,s.classList.add("hidden"),i.classList.remove("hidden"))}catch(e){x(),B("Error de conexión")}}),c&&l&&(c.addEventListener("input",L),l.addEventListener("input",L)),t&&t.addEventListener("submit",async e=>{e.preventDefault();e=c.value;w();try{var t=await(await fetch("/hash/cambiar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({usuario:E,nuevaPassword:e})})).json();x(),B(t.message),E="",i.classList.add("hidden"),s.classList.remove("hidden")}catch(e){x(),B("Error al cambiar contraseña")}}),m&&m.addEventListener("click",async()=>{w();try{var e=await(await fetch("/hash/sugerir")).json();x(),g.textContent=e.password,u.classList.remove("hidden")}catch(e){x(),B("Error al generar contraseña")}}),y&&y.addEventListener("click",()=>{c.value=g.textContent,l.value=g.textContent,L()}),h&&h.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(g.textContent),B("Contraseña copiada al portapapeles")}catch(e){B("No se pudo copiar")}}),a&&a.addEventListener("submit",async e=>{e.preventDefault();try{var t=await fetch("/hash/chpsw/"+p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nuevaPassword:c.value})});B((await t.json()).message),t.ok&&(a.reset(),o.innerHTML="")}catch{B("Error al cambiar la contraseña")}});